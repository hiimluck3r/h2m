---
- name: Create ~/manifests/dashboard directory if not exists
  file:
    path: "~/manifests/dashboard"
    state: directory

- name: Render dashboard manifests
  template:
    src: "roles/apps/manifests/dashboard/{{ item }}.yaml"
    dest: "~/manifests/dashboard/{{ item }}.yaml"
    owner: "{{ user }}"
    mode: '0644'
  with_list:
    - "manifest"
    - "httproute"

- name: Install dashboard
  kubernetes.core.k8s:
    state: present
    src: "~/manifests/dashboard/{{ item }}.yaml"
  with_list:
    - "manifest"
    - "httproute"
  when: dashboard|default(false)|bool == true

- name: Remove dashboard
  kubernetes.core.k8s:
    state: absent
    src: "~/manifests/dashboard/{{ item }}.yaml"
  with_list:
    - "manifest"
    - "httproute"
  when: dashboard|default(false)|bool == false