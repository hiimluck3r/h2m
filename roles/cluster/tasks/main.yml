---
# tasks file for cluster
- name: Install k3sup on a single-node cluster
  ansible.builtin.shell: "{{ item }}"
  with_list:
    - "curl -sLS https://get.k3sup.dev | sh"
    - "sudo install k3sup /usr/local/bin/"

- name: Create a k3s cluster
  ansible.builtin.shell: "{{ item }}"
  with_list:
    - "k3sup install --local --user --no-extras {{ user }}"
    - "sudo chmod 644 /etc/rancher/k3s/k3s.yaml"

- name: Check if cluster is ready
  ansible.builtin.shell: "k3sup ready --kubeconfig ./kubeconfig"